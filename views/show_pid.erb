<section id="pid_info">
  <h3><%= HTML_CONFIG['header_pid_view'] %> <%= @pid.id %><% if(@pid.deactivated) %><span class="red"> - <%= HTML_CONFIG['header_pid_inactive'] %></span><% end %></h3>
  
	<form action="/link/<%= @pid.id %>" method="get" id="pid_update" name="pid_update">
		<label><%= HTML_CONFIG['form_pid'] %></label><span class="form_informational"><%= link_to(to("/PID/#{@pid.id}")) %></span>
		<label for="url"><%= HTML_CONFIG['form_url'] %></label><input type="text" id="url" name="url" style="width: 450px;" value="<%= @pid.url %>" />
		
		<% if @groups %>
			<label for="group"><%= HTML_CONFIG['form_group'] %></label>
			<select name="group" id="group">
				<% @groups.each do |group| %>
					<option value="<%= group.id %>" <% if @pid.group == group %>selected="selected"<% end %>><%= group.name %></option>
				<% end %>
			</select>
		<% else %>
			<input type="hidden" id="group" name="group" value="<%= @group %>" />
		<% end %>
		
		<label><%= HTML_CONFIG['form_created_date'] %></label>
		<span class="form_informational"><%= @pid.created_at.strftime("%a %b %e %k:%M:%S %Y") %></span>
		<label><%= HTML_CONFIG['form_modified_date'] %></label>
		<span class="form_informational"><%= @pid.modified_at.strftime("%a %b %e %k:%M:%S %Y") %></span>
		<label><%= HTML_CONFIG['form_modified_by'] %></label><span class="form_informational"><%= @pid.username %></span>
		<label><%= HTML_CONFIG['form_change_category'] %></label><span class="form_informational"><%= @pid.change_category %></span>
		<label for="active"><%= HTML_CONFIG['form_active'] %></label>
		<input type="checkbox" id="active" name="active" <%= !@pid.deactivated ? 'checked="checked"' : '' %>" />
		<label>&nbsp;</label><input type="submit" id="submit" name="submit" value="<%= HTML_CONFIG['button_update_pid'] %>" />
	</form>
</section>

<section class="errors">
	<%= "#{@msg}<br /><br />" %>
	
  <% if @pid.errors %>
    <% @pid.errors.full_messages.each do | message | %>
      <%= message %></br>
    <% end %>
  <% end %>
</section>

<section id="pid_history">
  <h3><%= HTML_CONFIG['header_pid_history'] %></h3>
  
  <% @pid.pid_versions.sort{ |x,y| y.created_at <=> x.created_at }.each do | version | %>
      
    <% unless @pid.url == version.url && @pid.modified_at == version.created_at %>
			<form>
				<label><%= HTML_CONFIG['form_old_url'] %></label><span class="form_informational"><%= version.url %></span>
        <label><%= HTML_CONFIG['form_created_by'] %></label><span class="form_informational"><%= version.username %></span>
        <label><%= HTML_CONFIG['form_created_date'] %></label>
				<span class="form_informational"><%= version.created_at.strftime("%a %b %e %k:%M:%S %Y") %></span>
        <label><%= HTML_CONFIG['form_change_category'] %></label><span class="form_informational"><%= version.change_category %></span>
        <label><%= HTML_CONFIG['form_active'] %></label><span class="form_informational"><%= (version.deactivated) ? "No" : "Yes" %></span>
			</form>
			
			<hr />
    <% end %>
    
  <% end %>
</section>

<script type="text/javascript">
	$("#submit").click( function(event){
  	event.preventDefault();
	
		var validation = validate(["url", "group"], [], ["url"], [ [] ]);
	
		// If there were no validation errors submit the changes to the application
		if( validation == '' ){
	
  		$.ajax({
    		url:      '/link/<%= @pid.id %>',
    		type:     'put',
				data: 		$("#pid_update").serialize(), 
    		success:  function(data) {
					$("body").html(data);
					$(".errors").css('color', '#298A08');
				},
    		error: function(data) {
					$("body").html(data);
    		},
    		complete: {}
  		});
		
		// Otherwise display the errors to the user.
		}else{
			$(".errors").html(validation);
		}
	});
</script>