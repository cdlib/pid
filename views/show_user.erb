<section id="user_update">
	<h3><%= form_text('header_user_view') %></h3>
	
	<% if @groups %>
		<a href="/user/list" class="letterpress right"><%= form_text('link_to_user_list') %></a>
	<% end %>
		
	<form>
		<label for="group"><%= form_text('form_group') %></label>
		<% if @groups %>
			
			<% if @groups.size > 1 %>
				<select name="group" id="group">
					<% @groups.each do |group| %>
						<option value="<%= group.id %>" <%= 'selected="true"' if @user.group.id == group.id %>><%= group.name %></option>
					<% end %>
				</select>
			<% else %>
				<input type="text" id="group" name="group" readonly="true" value="<%= @user.group.name %>" />
			<% end %>
			
			<label for="maintainer"><%= form_text('form_group_maintainer') %></label><input type="checkbox" name="maintainer" id="maintainer" <% if @maintainer %>checked="checked"<% end %> />
			<label for="active"><%= form_text('form_active') %></label><input type="checkbox" name="active" id="active" <% if @user.active %>checked="checked"<% end %> />
			<label for="locked"><%= form_text('form_locked') %></label><input type="checkbox" name="locked" id="locked" <% if @user.locked %>checked="checked"<% end %> />
		
		<% else %>
			<input type="text" id="group" name="group" readonly="true" value="<%= @user.group.name %>" />
			<input type="hidden" id="maintainer" name="maintainer" value="<%= (@maintainer) ? 'on' : 'off' %>" />
			<input type="hidden" id="active" name="active" value="<%= (@user.active) ? 'on' : 'off' %>" />
			<input type="hidden" id="locked" name="locked" value="<%= (@user.locked) ? 'on' : 'off' %>" />
		<% end %>
		
		<label for="login"><%= form_text('form_userid') %></label><input type="text" name="login" id="login" value="<%= @user.login %>" />
		<label for="name"><%= form_text('form_name') %></label><input type="text" name="name" id="name" value="<%= @user.name %>" />
		<label for="email"><%= form_text('form_email') %></label><input type="email" name="email" id="email" value="<%= @user.email %>" />
		<label for="affiliation"><%= form_text('form_affiliation') %></label><input type="text" name="affiliation" id="affiliation" value="<%= @user.affiliation %>" />
		
		<label for="password"><%= form_text('form_new_password') %></label><input type="password" name="password" id="password" />
		<label for="confirm"><%= form_text('form_confirm_password') %></label><input type="password" name="confirm" id="confirm" />
		<label>&nbsp;</label><input type="submit" id="submit" name="submit" value="<%= form_text('button_save_user') %>" />
	</form>
	
</section>

<section class="errors">
	<%= "#{@msg}<br /><br />" %>
	
  <% if @user.errors %>
    <% @user.errors.full_messages.each do | message | %>
      <%= message %></br>
    <% end %>
  <% end %>
</section>


<script type="text/javascript">
  
    $("#submit").click( function(event){
      event.preventDefault();
			
			var validation = validate(["login", "name", "email", "group"], ["email"], [], [ ["password", "confirm"] ]);
			
			// If there were no validation errors submit the changes to the application
			if( validation == '' ){
			
      	$.ajax({
        	url:      '/user/<%= @user.id %>',
        	type:     'put',
					data: 		$("form").serialize(), 
        	success:  function(data) {
						$("body").html(data);
						$(".errors").css('color', '#298A08');
					},
        	error: function(data) {
						$("body").html(data);
        	},
        	complete: {}
      	});
				
			// Otherwise display the errors to the user.
			}else{
				$(".errors").html(validation);
			}
    });
		
</script>