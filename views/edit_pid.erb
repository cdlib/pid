<section id="pid_edit">
  <h3><%= HTML_CONFIG['header_pid_edit'] %></h3>
	
	<article><%= HTML_CONFIG['edit_pid_text'] %></article>
	
	<form action="/link/batch" method="post" enctype="multipart/form-data">
		<label>File:</label><input type="file" id="csv" name="csv" accept="csv" />
		<label>&nbsp;</label><input type="submit" id="submit" name="submit" value="<%= HTML_CONFIG['button_process_batch'] %>">
		<progress></progress>
	</form>
	
</section>

<section class="errors">
	<%= "#{@msg}<br /><br />" %>
</section>

<section id="batch_results">
	
</section>


<script type="text/javascript">

	$('progress').hide();

	/*
	$("#submit").click( function(e) {
		e.preventDefault();
		
		if($("#csv").val().trim() != ''){
			var reader = new FileReader();
			var xhr = new XMLHttpRequest();
			this.xhr = xhr;
			
			this.xhr.upload.addEventListener('progress', progressHandlingFunction, false);
			
alert("made it");			
			
			xhr.open('POST', '/link/batch');
			
			reader.onload = function(e){
				xhr.sendAsBinary(e.target.result);
			}
			reader.readAsBinaryString($("#csv"));
			
			/*
			$.ajax({
				url: "/link/batch",
				type: "post",
				data: new FormData($('form')[0]),
				xhr: function(){
					var xhr = $.ajaxSettings.xhr();
					
					if(xhr.upload){
						xhr.upload.addEventListener('progress', progressHandlingFunction, false);
					}
					return xhr;
				},
				beforeSend: function() {
					$('progress').show();
				},
				success:  function(data) {
          $("#batch_results").html(data);
        },
        error: function(data) {
          $("#errors").html('<%= MESSAGE_CONFIG['batch_upload_failure'] %>');
        }, 
				complete: function(){
					$('progress').hide();
				}
			});
	
		}else{
			$("#csv").html("");
		}
		
	});
	*/
	
	function progressHandlingFunction(e){
		if(e.lengthComputable){
			$('progress').attr({value: e.loaded, max: e.total});
		}
	}

</script>